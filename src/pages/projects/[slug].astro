---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(project => ({
    params: { slug: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await render(project);
const { title, summary, platforms, storeUrl, repoUrl, siteUrl, icon, type } = project.data;
---

<BaseLayout title={title} description={summary}>
  <article class="space-y-6">
    <header class="space-y-4">
      <div class="flex items-start gap-4">
        {icon && (
          <img
            src={icon}
            alt={title}
            class="w-20 h-20 rounded-2xl object-cover flex-shrink-0"
          />
        )}
        <div>
          <h1 class="text-2xl font-bold">{title}</h1>
          <p class="text-neutral-600 dark:text-neutral-400 mt-1">{summary}</p>
        </div>
      </div>
      <div class="flex gap-2 flex-wrap">
        {platforms.map(platform => (
          <span class={`text-xs px-2 py-1 rounded ${platform.status === 'active' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300'}`}>
            {platform.name}{platform.status !== 'active' && ' (開発中)'}
          </span>
        ))}
      </div>
    </header>

    <div class="flex gap-3 flex-wrap">
      {storeUrl && (
        <a
          href={storeUrl}
          class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"
          target="_blank"
          rel="noopener"
        >
          App Store
        </a>
      )}
      {siteUrl && (
        <a
          href={siteUrl}
          class="px-4 py-2 border border-neutral-200 dark:border-neutral-700 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-900 transition-colors"
          target="_blank"
          rel="noopener"
        >
          Website
        </a>
      )}
      {repoUrl && (
        <a
          href={repoUrl}
          class="px-4 py-2 border border-neutral-200 dark:border-neutral-700 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-900 transition-colors"
          target="_blank"
          rel="noopener"
        >
          Repository
        </a>
      )}
    </div>

    <div class="prose max-w-none">
      <Content />
    </div>
  </article>
</BaseLayout>
